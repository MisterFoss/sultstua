<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SULTSTUA</title>
    <link rel="stylesheet" href="main.css"/>
</head>
<body>
    <header>
        <h1>
            Sultstua Q2 2021
        </h1>
        <h2>
            List qualifier
        </h2>
    </header>
    <main>


<!-- Table goes here -->

<script>


function createCellFromTemplate(anime){
    let template = document.getElementById("list-cell-template");
    let fragment = template.content.cloneNode(true);

    fragment.querySelector(".poster").setAttribute("src", anime.coverImage.large)
    fragment.querySelector(".cell").setAttribute("style", `--poster-color:${anime.coverImage.color};`);


    let title;
    if(anime.title.english) {
        title = anime.title.english;
    } else {
        title = anime.title.romaji;
    }
    fragment.querySelector(".title").innerText = title;


    if(anime.trailer){
        let trailerHref;
        if(anime.trailer.site === "youtube"){
            trailerHref = `https://www.youtube.com/watch?v=${anime.trailer.id}`
        } else {
            trailerHref = "#";
        }
        fragment.querySelector(".trailer a").href = trailerHref;
    } else {
        fragment.querySelector(".trailer a").remove();
    }

    fragment.querySelector(".synopsis").innerText = anime.description;

    let tags = fragment.querySelector(".tags");
    for(let genre of anime.genres){
        let tagElement = document.createElement("div");
        tagElement.classList.add("tag");
        tagElement.dataset["tag"] = genre.toLowerCase();
        tagElement.innerText = genre;
        tags.appendChild(tagElement);
    }
    fragment.querySelector(".points").innerText = anime.averageScore;
    return fragment;
}

</script>
<template id="list-cell-template">
    <div class="cell">
        <div class="splash">
            <img class="poster" src="" alt="">
        </div>
        <div class="info">
            <h3 class="title"> 
            </h3>
            <div class="trailer">
                <a>Trailer</a>
            </div>
            <div class="synopsis">
            </div>
            <div class="tags">
            </div>
            <div class="points">
            </div>
        </div>
    </div>
</template>

<div id="list" class="list">
</div>


    <script>
        async function fetchQualifier(){
            let response = await fetch("http://localhost:5000/testQualifier", {
                "method": "GET",
                "mode": "cors",
                "credentials": "omit"
            });
            console.log(response, response.status);
            let json = await response.json();
            console.log(json);
            return json;
        }

        window.addEventListener("load", async function(event) {
            let animeList = await fetchQualifier();

            let list = document.getElementById("list");
            for(let anime of animeList) {
                list.append(createCellFromTemplate(anime));
            }
        })
    </script>

</body>
</html> 