<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SULTSTUA</title>
    <link rel="stylesheet" href="main.css"/>
</head>
<body>
    <header>
        <h1 class="header">
        </h1>
        <h2>
            <span class="logged-in">
                Logged in as <span id="loggedInAs"></span>
                <button id="logout-button">
                    Log out
                </button>
            </span>
            <span class="logged-out">
                <button id="login-button">
                    Log in
                </button>
            </span>
            <style>
                body[data-user] .logged-out {
                    display: none;
                }
                body:not([data-user]) .logged-in {
                    display: none;
                }
            </style>
        </h2>
        <h3>
            <span class="finalize">
                Move form Prelim to Tournament
                <button id="finalize-button">
                    OK
                </button>
        </h3>
    </header>
    <div id="list" class="list">

    </div>
</body>
<script type="module">
    import {displayLogin} from './view/user.js';
    import {postJson} from './utils/utils.js';
    import {makeQualifierList} from './view/qualifierList.js';

    displayLogin();

    let searchParams = new URLSearchParams(window.location.search);
    let tourId = searchParams.get("tournamentId");


    /**
     * 
    tour["animes"] = dataList
    tour["tournamentName"] = db.getTournamentName(tournamentId)
    tour["score"] = db.getTournamentScore(tournamentId)
    tour["stage"] = db.getTournamentStage(tournamentId)

    {
        animes: Array<{
            id: number <-- anilist_id,
            ...
        }>
        score: Array<{
            anilist_id: number,
            score: number
        }>,
        tournamentName: string,
        stage: 1 | 2
    }

     */
    let tournamentData;
    async function onLoad(){
        let response = await fetch("/api/getTournament/"+tourId, {
            "method": "GET",
        });
        tournamentData = await response.json();
        console.log(tournamentData);
        document.querySelector(".header").innerText=tournamentData.tournamentName
        if (tournamentData.stage == 1){
            makeQualifierList(tournamentData)
        }
        else if(tournamentData.stage == 2){
            createBracket(tournamentData)
        };

    };
    window.addEventListener("load", onLoad);


    let finalizeButton= document.getElementById("finalize-button");
    finalizeButton.addEventListener("click", prelimToBrackets());


function getScoreByAnilistId(anilistId){
    for(let item of tournamentData.score){
        if(item.anilist_id === anilistId){
            return item.score;
        }
    }
    return null;
}

    function prelimToBrackets(){
        
    }

    function createBracket(){

}

</script>

<template id="list-cell-template">
        <div class="cell">
            <div class="splash">
                <img class="poster" src="" alt="">
            </div>
            <div class="info">
                <h3 class="title"> 
                </h3>
                <div class="trailer">
                    <a>Trailer</a>
                </div>
                <div class="synopsis">
                </div>
                <div class="tags">
                </div>
                <div class="points">
                </div>
            </div>
        </div>
</template>

<template id="tournament-bracket">
</template>

<template>
    <form class="score-form">
        <input type="hidden" name="animeId" value="">
        <input type="number" name="score" value="50" step="1" min="0" max="100">
        <input type="submit" value="send">
    </form>
</template>

