<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SULTSTUA</title>
    <link rel="stylesheet" href="main.css"/>
</head>
<body>
    <header>
        <h1>
            Sultstua Q2 2021
        </h1>
        <h2>
            Create a new Tournament!
        </h2>
    </header>
    <main>


<!-- Table goes here -->

<script>


let state = {
    loading: false,
    query: {
        season: "SUMMER",
        seasonYear: 2021,
    },
    animeList: null
}

function createCellFromTemplate(anime){
    let template = document.getElementById("list-cell-template");
    let fragment = template.content.cloneNode(true);

    fragment.querySelector(".poster").setAttribute("src", anime.coverImage.large)
    fragment.querySelector(".cell").setAttribute("style", `--poster-color:${anime.coverImage.color};`);


    let title;
    if(anime.title.english) {
        title = anime.title.english;
    } else {
        title = anime.title.romaji;
    }
    fragment.querySelector(".title").innerText = title;


    if(anime.trailer){
        let trailerHref;
        if(anime.trailer.site === "youtube"){
            trailerHref = `https://www.youtube.com/watch?v=${anime.trailer.id}`
        } else {
            trailerHref = "#";
        }
        fragment.querySelector(".trailer a").href = trailerHref;
    } else {
        fragment.querySelector(".trailer a").remove();
    }

    fragment.querySelector(".synopsis").innerText = anime.description;

    let tags = fragment.querySelector(".tags");
    for(let genre of anime.genres){
        let tagElement = document.createElement("div");
        tagElement.classList.add("tag");
        tagElement.dataset["tag"] = genre.toLowerCase();
        tagElement.innerText = genre;
        tags.appendChild(tagElement);
    }
    fragment.querySelector(".points").innerText = anime.averageScore;
    return fragment;
}

</script>
<template id="list-cell-template">
    <div class="cell">
        <div class="splash">
            <img class="poster" src="" alt="">
        </div>
        <div class="info">
            <h3 class="title"> 
            </h3>
            <div class="trailer">
                <a>Trailer</a>
            </div>
            <div class="synopsis">
            </div>
            <div class="tags">
            </div>
            <div class="points">
            </div>
        </div>
    </div>
</template>

<form id="query">
    <select name="season">
        <option value="WINTER">Winter</option>
        <option value="SPRING">Spring</option>
        <option value="SUMMER">Summer</option>
        <option value="FALL">Autumn</option>
    </select>
    <input type="number" id="seasonYear" name="seasonYear" min="1" value="1999">
    <input type="submit" value="Lag!">
</form>


<div id="list" class="list">
</div>



    <script src="fetchData.js"></script>
    <script>
        let seasonYearElement = document.getElementById("seasonYear");
        seasonYearElement.setAttribute("value", new Date().getUTCFullYear());

        let queryForm = document.getElementById("query");

        let anilistQuery = 

        queryForm.addEventListener("submit", async function(event) {
            event.preventDefault();

            let queryData = new FormData(queryForm);

            let season = queryData.get("season");
            let seasonYear = queryData.get("seasonYear");

            let animeList = await fetchListOfAnime(season, seasonYear);


            let list = document.getElementById("list");
            for(let anime of animeList) {
                list.append(createCellFromTemplate(anime));
            }
        })
    </script>

</body>
</html> 